<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step-by-step • mbbe</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Step-by-step">
<meta property="og:description" content="mbbe">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mbbe</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/Step-by-Step.html">Step by Step</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://certara.github.io/R-Certara/index.html" class="external-link">Certara.R</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/certara/mbbe/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Step-by-step</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/certara/mbbe/blob/HEAD/vignettes/Step-by-Step.Rmd" class="external-link"><code>vignettes/Step-by-Step.Rmd</code></a></small>
      <div class="hidden name"><code>Step-by-Step.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="files">Files<a class="anchor" aria-label="anchor" href="#files"></a>
</h3>
<p>Three, with an optional fourth type of files are needed for execution
of the MBBE package. These are:</p>
<ol style="list-style-type: decimal">
<li><p>Model files. Standard NONMEM control files, one or more
describing one or more candidate models to be averaged.</p></li>
<li><p>Data file(s) - one or two. A analysis data set for the NONMEM
model estimation in the bootstrap is required. In addition data file for
simulation of the intended virtual BE study is required. These may be
the same file.</p></li>
<li><p>The MBBE specification file. A json format file describing the
analysis.</p></li>
<li><p>(Optional) User supplied R code that returns a value that can be
added to the default model selection criteria (BIC) used for model
averaging. Must be called “RPenaltyCode.R”.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="first-you-need-models">First you need model(s)<a class="anchor" aria-label="anchor" href="#first-you-need-models"></a>
</h2>
<p>Five models are provided with the MBBE package. Any number of model
&gt; 1 can be used, bearing mind that the total number of bootstrap
samples will be the number of models x the sample size. These models
were selected using <a href="https://certara.github.io/pyDarwin/html/index.html" class="external-link">pyDarwin</a>.
Example models (model1.mod - model5.mod) are at:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"mbbe"</span>,<span class="st">"examples"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(models_path, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.mod$"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"model1.mod"</span> <span class="st">"model2.mod"</span> <span class="st">"model3.mod"</span> <span class="st">"model4.mod"</span> <span class="st">"model5.mod"</span></span></code></pre></div>
<p>Let’s view an example model file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">readLines</span>(<span class="fu">list.files</span>(models_path, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.mod$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">"$PROBLEM    Simulated"</span>                                                                                       </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">2</span>] <span class="st">"$INPUT      ID TIME AMT DROP CMT CMTT DV WT EGFR AGE COV1 COV2 EVID"</span>                                         </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">3</span>] <span class="st">"            PERIOD GROUP TRT SEQ"</span>                                                                            </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">4</span>] <span class="st">"$DATA       data.csv IGNORE=@ REWIND"</span>                                                                        </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">"$OMEGA"</span>                                                                                                      </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a> [<span class="dv">6</span>] <span class="st">" 1  FIX  ;  ETA(1) CL"</span>                                                                                       </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] <span class="st">" 1  FIX  ;  ETA(2) V2"</span>                                                                                       </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a> [<span class="dv">8</span>] <span class="st">"$OMEGA  BLOCK(1) FIX"</span>                                                                                        </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">" 1      ; ETA(3) BOVV"</span>                                                                                       </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">"$OMEGA  BLOCK(1) SAME"</span>                                                                                       </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">11</span>] <span class="st">"$OMEGA  BLOCK(1) SAME"</span>                                                                                       </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">12</span>] <span class="st">"$OMEGA  BLOCK(1) SAME"</span>                                                                                       </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">"$SIGMA  1  FIX"</span>                                                                                              </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">14</span>] <span class="st">";;;; Start subs"</span>                                                                                             </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">15</span>] <span class="st">"$SUBROUTINE ADVAN4"</span>                                                                                          </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">16</span>] <span class="st">"$PK"</span>                                                                                                         </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">17</span>] <span class="st">"  CWTKG</span><span class="sc">\t</span><span class="st">= WT/70"</span>                                                                                            </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">18</span>] <span class="st">"  CAGE</span><span class="sc">\t</span><span class="st">= AGE/24"</span>                                                                                            </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">19</span>] <span class="st">"  CEGFR</span><span class="sc">\t</span><span class="st">= EGFR/100"</span>                                                                                         </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">20</span>] <span class="st">"  CCOV1</span><span class="sc">\t</span><span class="st">= COV1/10"</span>                                                                                          </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>[<span class="dv">21</span>] <span class="st">"  CCOV2 = COV2/10"</span>                                                                                           </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">22</span>] <span class="st">"  IF(PERIOD.EQ.1) BOVV = EXP(THETA(14))*ETA(3)"</span>                                                              </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>[<span class="dv">23</span>] <span class="st">"  IF(PERIOD.EQ.2) BOVV = EXP(THETA(14))*ETA(4)"</span>                                                              </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">24</span>] <span class="st">"  IF(PERIOD.EQ.3) BOVV = EXP(THETA(14))*ETA(5)"</span>                                                              </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] <span class="st">"  IF(PERIOD.EQ.4) BOVV = EXP(THETA(14))*ETA(6)"</span>                                                              </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>[<span class="dv">26</span>] <span class="st">"  ;; COVARIATE POWER MODEL WITH COVARIATE CENTERED AT 1 CAN BE +IVE OR -IVE"</span>                                 </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>[<span class="dv">27</span>] <span class="st">"  TVCL</span><span class="sc">\t</span><span class="st">= EXP(THETA(1)) *CWTKG**THETA(15) *CAGE**THETA(16) *CEGFR**THETA(17)"</span>                                </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">28</span>] <span class="st">"  CL </span><span class="sc">\t</span><span class="st">= TVCL*EXP(EXP(THETA(4))*ETA(1))"</span>                                                                     </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">29</span>] <span class="st">"  TVV</span><span class="sc">\t</span><span class="st">= EXP(THETA(9)) *CWTKG**THETA(18)   *CCOV2**THETA(19)"</span>                                                </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>[<span class="dv">30</span>] <span class="st">"  V2 </span><span class="sc">\t</span><span class="st">= TVV *EXP(EXP(THETA(5))*ETA(2))*EXP(BOVV)"</span>                                                           </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>[<span class="dv">31</span>] <span class="st">"  IF(TRT.EQ.1) THEN ;; REFERENCE"</span>                                                                            </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>[<span class="dv">32</span>] <span class="st">"     TVKA </span><span class="sc">\t</span><span class="st">= EXP(THETA(6))"</span>                                                                                 </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>[<span class="dv">33</span>] <span class="st">"     F1</span><span class="sc">\t\t</span><span class="st">= 1"</span>                                                                                              </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>[<span class="dv">34</span>] <span class="st">"     ALAG1</span><span class="sc">\t</span><span class="st">= EXP(THETA(12))"</span>                                                                                </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">35</span>] <span class="st">"  ELSE   ;; TEST"</span>                                                                                            </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>[<span class="dv">36</span>] <span class="st">"     TVKA </span><span class="sc">\t</span><span class="st">= EXP(THETA(7))"</span>                                                                                 </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">37</span>] <span class="st">"     F1 </span><span class="sc">\t</span><span class="st">= EXP(THETA(8))"</span>                                                                                   </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>[<span class="dv">38</span>] <span class="st">"     ALAG1</span><span class="sc">\t</span><span class="st">= EXP(THETA(13))"</span>                                                                                </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>[<span class="dv">39</span>] <span class="st">"  END IF"</span>                                                                                                    </span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>[<span class="dv">40</span>] <span class="st">"  S2   </span><span class="sc">\t</span><span class="st">= V2/1000 </span><span class="sc">\t</span><span class="st">; CONC IN NG/ML (MCG/L), DOSE IN MG, VOL IN L"</span>                                          </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>[<span class="dv">41</span>] <span class="st">"  K</span><span class="sc">\t</span><span class="st">= CL/V2"</span>                                                                                                </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>[<span class="dv">42</span>] <span class="st">"  KA </span><span class="sc">\t</span><span class="st">= TVKA"</span>                                                                                               </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>[<span class="dv">43</span>] <span class="st">"  K32 </span><span class="sc">\t</span><span class="st">= EXP(THETA(10))"</span>                                                                                    </span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>[<span class="dv">44</span>] <span class="st">"  K23</span><span class="sc">\t</span><span class="st">= EXP(THETA(11))"</span>                                                                                     </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>[<span class="dv">45</span>] <span class="st">""</span>                                                                                                            </span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>[<span class="dv">46</span>] <span class="st">"$ERROR"</span>                                                                                                      </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>[<span class="dv">47</span>] <span class="st">"  IPRED </span><span class="sc">\t</span><span class="st">= F"</span>                                                                                               </span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>[<span class="dv">48</span>] <span class="st">"  ADD  </span><span class="sc">\t\t</span><span class="st">= EXP(THETA(2)) ;; NEEDS TO BE HERE, TO EDIT IN SPPC"</span>                                             </span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>[<span class="dv">49</span>] <span class="st">"  PROP </span><span class="sc">\t\t</span><span class="st">= EXP(THETA(3))"</span>                                                                                  </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>[<span class="dv">50</span>] <span class="st">"  SD </span><span class="sc">\t\t</span><span class="st">= SQRT(PROP**2*IPRED**2 + ADD**2) ; Residual weight ADD AND P PROP IN SD AND CV UNITS, NOT VARIANCE"</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>[<span class="dv">51</span>] <span class="st">""</span>                                                                                                            </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>[<span class="dv">52</span>] <span class="st">"  Y </span><span class="sc">\t\t</span><span class="st">= IPRED + SD*EPS(1)"</span>                                                                                 </span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>[<span class="dv">53</span>] <span class="st">""</span>                                                                                                            </span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>[<span class="dv">54</span>] <span class="st">"  ;;;; Start EST"</span>                                                                                            </span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>[<span class="dv">55</span>] <span class="st">"$ESTIMATION METHOD=0  MAX=9999 NOABORT PRINT=50"</span>                                                             </span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>[<span class="dv">56</span>] <span class="st">"$THETA"</span>                                                                                                      </span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>[<span class="dv">57</span>] <span class="st">" (-0.1,0.217655,1 )    </span><span class="sc">\t\t</span><span class="st">  ; THETA(1) LN(CL)"</span>                                                              </span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>[<span class="dv">58</span>] <span class="st">" -8.01311 </span><span class="sc">\t</span><span class="st">    </span><span class="sc">\t</span><span class="st">; THETA(2) ADD ERROR"</span>                                                                      </span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>[<span class="dv">59</span>] <span class="st">" -2.97418 </span><span class="sc">\t\t</span><span class="st">    ; THETA(3) PROP ERROR"</span>                                                                     </span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>[<span class="dv">60</span>] <span class="st">" -2.11537 </span><span class="sc">\t\t</span><span class="st">    ; THETA(4) LN(BSV) CL"</span>                                                                     </span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>[<span class="dv">61</span>] <span class="st">" -2.08401 </span><span class="sc">\t\t</span><span class="st">    ; THETA(5) LN(BSV) V2"</span>                                                                     </span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>[<span class="dv">62</span>] <span class="st">" (-2,-0.999677,1) </span><span class="sc">\t\t</span><span class="st">; THETA(6) LN(KA) reference"</span>                                                           </span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>[<span class="dv">63</span>] <span class="st">" (-2,-1.00021,1) </span><span class="sc">\t\t</span><span class="st">; THETA(7) LN(KA) test"</span>                                                                 </span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>[<span class="dv">64</span>] <span class="st">" (-2,-0.00145444,1)</span><span class="sc">\t</span><span class="st">; THETA(8) LN(F1) TEST"</span>                                                                 </span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>[<span class="dv">65</span>] <span class="st">" (-0.4,0.0907959,2) </span><span class="sc">\t\t</span><span class="st">; THETA(9) init for V2"</span>                                                              </span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>[<span class="dv">66</span>] <span class="st">" (-4,3.86313,5)</span><span class="sc">\t</span><span class="st">; THETA(10) LN(K32)"</span>                                                                        </span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>[<span class="dv">67</span>] <span class="st">" (-5,-4.98,5) </span><span class="sc">\t</span><span class="st">; THETA(11) LN(K23)"</span>                                                                         </span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>[<span class="dv">68</span>] <span class="st">" (-2,-0.500031,1)</span><span class="sc">\t</span><span class="st">; THETA(12) LN(ALAG) REFERENCE"</span>                                                           </span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>[<span class="dv">69</span>] <span class="st">" (-2,-0.501282,1) </span><span class="sc">\t</span><span class="st">; THETA(13) LN(ALAG) test"</span>                                                               </span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>[<span class="dv">70</span>] <span class="st">" (-10,-9.95133,1) </span><span class="sc">\t</span><span class="st">; THETA(14) BOVV"</span>                                                                        </span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>[<span class="dv">71</span>] <span class="st">" -0.0580956 </span><span class="sc">\t</span><span class="st">; THETA(15) CL~WT"</span>                                                                             </span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>[<span class="dv">72</span>] <span class="st">" 0.466584 </span><span class="sc">\t\t</span><span class="st">; THETA(16) CL~AGE"</span>                                                                            </span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>[<span class="dv">73</span>] <span class="st">" -2.01063 </span><span class="sc">\t\t</span><span class="st">; THETA(17) CL~EGFR"</span>                                                                           </span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>[<span class="dv">74</span>] <span class="st">" 0.0318797 </span><span class="sc">\t\t</span><span class="st">; THETA(18) V~WT estimated"</span>                                                                   </span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>[<span class="dv">75</span>] <span class="st">" -0.117087 </span><span class="sc">\t\t</span><span class="st">; THETA(19) V~COV2"</span>                                                                           </span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>[<span class="dv">76</span>] <span class="st">""</span>                                                                                                            </span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>[<span class="dv">77</span>] <span class="st">"$TABLE ID TIME GROUP TRT DV IPRED EVID PERIOD SEQ NOPRINT FILE=DATA.TXT NOHEADER NOAPPEND"</span>                   </span></code></pre></div>
<p>These model need not have a $COV record (unless that is needed for
any user defined R code). There are few restriction on the structure of
the model. However, there are a significant number of requirement for
both the control file and data file format. It is recommended that the
full path to the data set be provided in the $DATA record.</p>
<p>There are four critical requirements of the model files format. There
are:</p>
<ol style="list-style-type: decimal">
<li>The values</li>
</ol>
<ul>
<li><p>GROUP</p></li>
<li><p>PERIOD</p></li>
<li><p>SEQ</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Only THETAs may be estimated. To accomplish this, $OMEGA and $SIGMA
block can be FIXed to 1 and ETAs and EPSs multiplied by a THETA, see
examples at</li>
</ol>
<pre><code>C:/Users/jcraig/AppData/Local/R/win-library/4.3/mbbe/inst/examples</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><p>The $ESTIMATION record, followed by the $THETA block MUST be the
final two blocks in the control file (with the exception of any $TABLE
records that might be needed for any user supplied R code).</p></li>
<li><p>The line</p></li>
</ol>
<p>|;;;; Start EST.</p>
<p>must appear immediately before the $EST record. The reason for these
two requirements is that the simulation control files are constructed
from the analysis control files. All content in the analysis control
file is copied, then everything after the line</p>
<p>|;;;; Start EST</p>
<p>is removed and replace with a $SIM record, followed by the theta
estimates extracted from the .xml file for that model and bootstrap
sample. A $TABLE record is then added, with data items required for the
power calculation. Note that this $TABLE record appended to the
simulation control file will include:</p>
<ul>
<li><p>GROUP</p></li>
<li><p>PERIOD</p></li>
<li><p>SEQl</p></li>
</ul>
<p>and so these data must be available, either in the data set or
calculated in the analysis control file. In addition the $DATA record is
editted to reference the simulation data set, rather than the analysis
data Note that the $$INPUT record is preserved between the analysis
control file and the generated simulation control file, and so the
structure of the analysis and simulation data sets must be the same.</p>
<p>If identifiability check is requested, then the option
“SADDLE_RESET=1” must be included in the $ESTIMATION record.</p>
</div>
<div class="section level2">
<h2 id="next-you-need-two-data-sets-although-they-can-be-the-same-one">Next you need two data sets (although they can be the same one)<a class="anchor" aria-label="anchor" href="#next-you-need-two-data-sets-although-they-can-be-the-same-one"></a>
</h2>
<p>Two formatted data set are provide here:</p>
<pre><code>C:/Users/jcraig/AppData/Local/R/win-library/4.3/mbbe/inst/examples/data.csv
C:/Users/jcraig/AppData/Local/R/win-library/4.3/mbbe/inst/examples/data_sim.csv</code></pre>
<p>Note that, in this case, these two data sets are identical. In
general, the analysis data set, for bootstrap, will not be the same as
the simulation data. For example, it may be the case that only sparse
data may be available for analysis (e.g., clinical scenarios were few
samples can be collected), or a cross over study may not be feasible
(e.g., long acting injectables). Still the simulation must be done using
a traditional study design, e.g., 4 period, cross over study. The
typical scenario is to use a different study design that the study(ies)
that generated the observed data, assuming that if the observed data
were from an adequate BE study, those data would be used to assess
BE.</p>
<p>The analysis data set is specified on the $DATA record in the NONMEM
control files for the bootstrap. The simulation data set is specified as
in the MBBE specification file:</p>
<pre><code>C:/Users/jcraig/AppData/Local/R/win-library/4.3/mbbe/inst/examples/mbbeargs.json</code></pre>
<p>Several notes on the data:</p>
<ol style="list-style-type: decimal">
<li><p>Data item for “GROUP” (1,2 are reference, 3,4 are test in the
examples) is included both in the analysis data set and the simulation
data set. The example simulation data set (data_sim.csv) and the source
data set (data.csv) are both 4 period cross over studies, and so there
are 4 values for group (although only 2 formulations). It is not a
requirement that the source data be a typical 4 period cross over study,
although data for both test and reference formulation need to be
included in order to estimate any formulation effects.</p></li>
<li><p>Data item for “PERIOD” is provided (1-4). In general, between
occasion variability (e.g., by study period) should be assessed and
included in the model(s) is supported. The PERIOD data item is required
in both the source and simulation data sets.</p></li>
<li><p>Data item for sequence (“SEQ”) is provided (1-2). Presumable
period and sequence were tested in the model selection and not found to
be supported. However, they are required for the Monte Carlo simulation
and statistical testing.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="user-supplied-penalty-r-code">User supplied penalty R code<a class="anchor" aria-label="anchor" href="#user-supplied-penalty-r-code"></a>
</h2>
<p>The model averaging is, by default, based on the Bayesian Information
criteria (BIC), with the option to preclude any results that fail the <a href="https://www.page-meeting.org/pdf_assets/1345-PAGE_2017_SADDLE_RESET_Final.pdf" class="external-link">Identifiability
test</a>. Another, more general option is to include a user defined R
function, to return a penalty that is added to the BIC. The path to the
file containing this function can be specified in the R_code_path option
in the json file, and the user_R_code option set to “true”. The function
must be called MBBE_RPenaltyCode, and take the arguments:</p>
<ul>
<li><p>run_dir - the parent run directory, as specified in the json
file</p></li>
<li><p>this_model - the model number</p></li>
<li><p>this_samp - ths bootstrap sample number.</p></li>
</ul>
<p>These arguments can then be used to access any output from the NONMEM
bootstrap model, such the .lst file, the .xml file. The file structure
will be</p>
<p>run_dir/modelM/N</p>
<p>Where run_dir is the run directory (run_dir) specified in the
MBBEjson file, M is the model number and N is the bootstrap sample
number. The output (.lst) and xml (.xml) files will be called:</p>
<p>bsSampM_N.lst</p>
<p>and bsSampM_N.xml</p>
<p>respectively.</p>
<p>Where M is the model number and N is the bootstrap sample number. Any
$TABLE file, including $SIM output, that is specified in the analysis
control files can be accesses as well, using the file structure
information described above.</p>
<p>The function should return, in all case, a numeric penalty. An
example R to return a penalty for bias in simulated Cmax is given in
RPenaltyCode.R. This function requires that a 2nd problem (for
simulation) be included in the control files. An example where
RPenaltyCode.R returns a penalty for bias in prediction of Cmax is given
in:</p>
<pre><code>C:/Users/jcraig/AppData/Local/R/win-library/4.3/mbbe/inst/example/RPenaltyCode.R</code></pre>
<div class="section level3">
<h3 id="the-mbbe-specification-file">The MBBE Specification file<a class="anchor" aria-label="anchor" href="#the-mbbe-specification-file"></a>
</h3>
<p>An example MBBE specification file is given at:</p>
<pre><code>C:/Users/jcraig/AppData/Local/R/win-library/4.3/mbbe/inst/examples/mbbeargs.json</code></pre>
<p>The json file consists of key-value pairs. All pairs are required,
except “R_code_path”: is not required if “user_R_code”: if set to
false.</p>
<p>The key-value pairs are:</p>
<div class="section level5">
<h5 id="run_dir">“run_dir”:<a class="anchor" aria-label="anchor" href="#run_dir"></a>
</h5>
<p>(string) parent directory where NONMEM is to be run. The bootstrap
runs will be executed in run_dir/modelM/N</p>
<p>Where M is the model number and N is the bootstrap sample number. The
output (.lst) and xml (.xml) files will be bsSampM_N.lst and
bsSampM_N.xml</p>
</div>
<div class="section level5">
<h5 id="model_source">“model_source”:<a class="anchor" aria-label="anchor" href="#model_source"></a>
</h5>
<p>(list) A list of paths to the candidate models. Json syntax for list
is: [“path1”, “path2, …]. Note that separator in path will be forward
slash “/”.</p>
</div>
<div class="section level5">
<h5 id="num_parallel">“num_parallel”:<a class="anchor" aria-label="anchor" href="#num_parallel"></a>
</h5>
<p>(integer) Number of NONMEM executions to be run in parallel. In
general should not exceed the number cores</p>
</div>
<div class="section level5">
<h5 id="crash_value">“crash_value”:<a class="anchor" aria-label="anchor" href="#crash_value"></a>
</h5>
<p>(numeric) A value to be assigned to the model selection criteria if
the calculation fails. Should be larger than any anticipated value for
BIC + any R penalty.</p>
</div>
<div class="section level5">
<h5 id="nmfe_path">“nmfe_path”:<a class="anchor" aria-label="anchor" href="#nmfe_path"></a>
</h5>
<p>(string) Path to nmfe??.bat. Note that separator in path will be
forward slash “/”.</p>
</div>
<div class="section level5">
<h5 id="delta_parms">“delta_parms”:<a class="anchor" aria-label="anchor" href="#delta_parms"></a>
</h5>
<p>(numeric) Largest fractional difference between any parameters before
and after the SADDLE_RESET that is permitted. Any model/sample with a
value larger than delta_parm will result in a failed idenfiability test
for that model/sample and will be be selected for the model averaging.
If all models for a given sample fail the identifiability test, that
sample is excluded from the Monte Carlo simulation.</p>
</div>
<div class="section level5">
<h5 id="use_check_identifiable">“use_check_identifiable”:<a class="anchor" aria-label="anchor" href="#use_check_identifiable"></a>
</h5>
<p>(logical) true or false, if identifability is to be checked.</p>
</div>
<div class="section level5">
<h5 id="nca_end_time">“NCA_end_time”:<a class="anchor" aria-label="anchor" href="#nca_end_time"></a>
</h5>
<p>(numeric) End time for calculation of AUC</p>
</div>
<div class="section level5">
<h5 id="rndseed">“rndseed”:<a class="anchor" aria-label="anchor" href="#rndseed"></a>
</h5>
<p>(integer) Random seed for Bootstrap sampling and Monte Carlo
Simulation</p>
</div>
<div class="section level5">
<h5 id="simulation_data_path">“simulation_data_path”:<a class="anchor" aria-label="anchor" href="#simulation_data_path"></a>
</h5>
<p>(string) Path to simulation data set. Note that separator in path
will be forward slash “/”.</p>
</div>
<div class="section level5">
<h5 id="ngroups">“ngroups”:<a class="anchor" aria-label="anchor" href="#ngroups"></a>
</h5>
<p>(integer) Number of GROUPs.</p>
</div>
<div class="section level5">
<h5 id="samp_size">“samp_size”:<a class="anchor" aria-label="anchor" href="#samp_size"></a>
</h5>
<p>(integer) Number of bootstrap and Monte Carlo Simulations</p>
</div>
<div class="section level5">
<h5 id="reference_groups">“reference_groups”:<a class="anchor" aria-label="anchor" href="#reference_groups"></a>
</h5>
<p>(list of integers) Which of the GROUPS are reference formulation</p>
</div>
<div class="section level5">
<h5 id="test_groups">“test_groups”:<a class="anchor" aria-label="anchor" href="#test_groups"></a>
</h5>
<p>(list of integers) Which of the GROUPS are test formulation</p>
<p>##### “plan”:</p>
<p>(string)- strategy for running R parallel. <a href="https://rdrr.io/cran/future/man/plan.html" class="external-link">Options are</a>:</p>
<p>sequential: Resolves futures sequentially in the current R process,
e.g. plan(sequential).</p>
<p>multisession: Resolves futures asynchronously (in parallel) in
separate R sessions running in the background on the same machine,
e.g. plan(multisession) and plan(multisession, workers = 2).</p>
<p>multicore: Resolves futures asynchronously (in parallel) in separate
forked R processes running in the background on the same machine,
e.g. plan(multicore) and plan(multicore, workers = 2). This backend is
not supported on Windows.</p>
</div>
<div class="section level5">
<h5 id="alpha_error">“alpha_error”:<a class="anchor" aria-label="anchor" href="#alpha_error"></a>
</h5>
<p>(numeric)- alpha error for computing one sided T tests</p>
</div>
<div class="section level5">
<h5 id="ntid">“NTID”:<a class="anchor" aria-label="anchor" href="#ntid"></a>
</h5>
<p>(logical) true or false, whether this is a narrow therapeutic index
drug.</p>
</div>
<div class="section level5">
<h5 id="model_averaging_by">“model_averaging_by”:<a class="anchor" aria-label="anchor" href="#model_averaging_by"></a>
</h5>
<p>(string) “study” | “subject”. “study” is recommended, “subject” is
experimental</p>
</div>
<div class="section level5">
<h5 id="user_r_code">“user_R_code”:<a class="anchor" aria-label="anchor" href="#user_r_code"></a>
</h5>
<p>(logical) true of false, if user supplied R code is to be run and
included in model averaging penalty. If true, R_code_path is
required.</p>
</div>
<div class="section level5">
<h5 id="r_code_path">“R_code_path”:<a class="anchor" aria-label="anchor" href="#r_code_path"></a>
</h5>
<p>(string) - path to user supplied R code for calculating additional
penalty for model averaging.</p>
</div>
</div>
<div class="section level3">
<h3 id="execution">Execution<a class="anchor" aria-label="anchor" href="#execution"></a>
</h3>
<p>MBBE is executed from the command line with</p>
<p><em>mbbe::run_mbbe_json(“path”)</em></p>
<p>where <em>“path</em>” is the path to the MBBE specification file.</p>
</div>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
</div>
<div class="section level2">
<h2 id="console-output">Console output<a class="anchor" aria-label="anchor" href="#console-output"></a>
</h2>
<p>The start date and time of each event in the MBBE process will be
listed. The initial output from MBBE describes the options for running
MBBE and results of checks.</p>
<p>When the bootstrap starts, MBBE will print out a progress line that
describes what percent of the bootstrap models have been started.
Completion of the bootstrap step will occur after all the models are
started, and them completed.</p>
<p>Various status update message will be displayed as the bootstrap is
completed, model parameters are collected, if requested, user supplied R
code penalty etc.</p>
<p>Once the BIC and total penalty values are calculated, they will be
displayed.</p>
<p>When available, the estimated power for Cmax, AUC<sub>last</sub> and
AUC<sub>infinity</sub> will be displayed and the number of bootstrap
sample for each model that are identifable is output.</p>
<p>Finally, the statistical output includes, for each Monte Carlo
simulation, whether the parameters (Cmax, AUC<sub>last</sub> and
AUC<sub>infinity</sub>) are bioequivalence, the ratio for each and the
upper and lower limits of the confidence interval for the ratio.</p>
<div class="section level3">
<h3 id="file-output">File output<a class="anchor" aria-label="anchor" href="#file-output"></a>
</h3>
<p>A comma seprated file with BIC values will be written to</p>
<p>run_dir/BICS.csv and total penalties written to</p>
<p>run_dir/Total_penalties.csv</p>
<p>where run_dir is the run directory specified in the MBBE
specification file.</p>
<p>The power for each parameter is written out to the file</p>
<p>run_dir/MBBEpower[data-time].csv</p>
<p>where [data-time] is the analysis completion date and time.</p>
<p>All statistical results are written to run_dir/All_results.csv.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-the-example-">Running the example.<a class="anchor" aria-label="anchor" href="#running-the-example-"></a>
</h2>
<p>An example can run run using the provide control files, data sets and
mbbe options file with the command:</p>
<p>mbbe::run_example(run_dir, nmfe??.bat, Include_R_Code, plan)</p>
<p>where:</p>
<ul>
<li><p>run_dir (string) is the parent directory for NONMEM
execution</p></li>
<li><p>nmfe??.bat (string) is the full path the the nmfe??.bat file,
where ?? is the NONMEM version (e.g.,
c:/nmfe74/util/nmfe74.bat)</p></li>
<li><p>Include_R_Code = (logical), whether to include the (provided)
script for a penalty in the model averaging. R script can be found in
the file RPenaltyCode.r in run_dir. Default value is FALSE</p></li>
<li><p>plan is one of “sequential”, “multicore”, “multisession” with a
default of “multisession”</p></li>
</ul>
<p>The num_parallel will be set to the number of cores -1 or 1 if there
is only 1 core, and the analysis executed. Execution on a 32 core
machine with Include_R_Code set to FALSE takes ~4 minutes. The sample
size for the bootstrap and Monte Carlo simulation is set to only 4,
which will give a very poor estimate of power. That said the simulation
data set has a very different Cmax for Test vs Reference, but a similar
AUC, and the power estimate will reflect this, with power =0 for Cmax
and power = 1 for both AUClast and AUCinf. Further, to reduce execution
time, the FO method is used for the bootstrap, rather than FOCEI.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mark Sale, James Craig, Michael Tomashevskiy.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
